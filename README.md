# UniversalNativeWrapper

COM-–æ–±–µ—Ä—Ç–∫–∞ –¥–ª—è 1–°, –∫–æ—Ç–æ—Ä–∞—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞–µ—Ç native-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
(AddIn Native API), –ø—Ä–æ–∫—Å–∏—Ä—É–µ—Ç –∏—Ö –º–µ—Ç–æ–¥—ã/—Å–≤–æ–π—Å—Ç–≤–∞ –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ä–∞–±–æ—Ç—É
–Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ.

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
- `setDriverName(–ü—É—Ç—å, –ò–º—è–ö–ª–∞—Å—Å–∞)` –∑–∞–≥—Ä—É–∂–∞–µ—Ç DLL, —Å–æ–∑–¥–∞–µ—Ç native-–æ–±—ä–µ–∫—Ç,
  –ø–µ—Ä–µ–¥–∞–µ—Ç `MyMemoryManager`, –≤—ã–∑—ã–≤–∞–µ—Ç `Init` –∏ –≥–æ—Ç–æ–≤–∏—Ç –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ.
- –ü—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ—Ç–æ–¥–æ–≤/—Å–≤–æ–π—Å—Ç–≤ (–≤–∫–ª—é—á–∞—è –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ —Å—Å—ã–ª–∫–µ).
- –ù–µ—Å–∫–æ–ª—å–∫–æ COM-–æ–±—ä–µ–∫—Ç–æ–≤ –º–æ–≥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å —Ä–∞–∑–Ω—ã–º–∏ DLL –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ.
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ `temp/UniversalNativeWrapper.log`.

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è –≤ –≤–µ—Ä—Å–∏–∏ 2.0

–ü–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≤–µ—Ä—Å–∏–µ–π (test/AddinCom.cpp), –Ω–æ–≤–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–µ—Ç–µ—Ä–ø–µ–ª–∞ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:

### üîÑ –ú–Ω–æ–≥–æ—ç–∫–∑–µ–º–ø–ª—è—Ä–Ω–æ—Å—Ç—å –∏ –∏–Ω–∫–∞–ø—Å—É–ª—è—Ü–∏—è
- **–†–∞–Ω—å—à–µ**: –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ (`native_component`, `LIB_NATIVE`) –ø–æ–∑–≤–æ–ª—è–ª–∏ —Ä–∞–±–æ—Ç–∞—Ç—å —Ç–æ–ª—å–∫–æ —Å –æ–¥–Ω–æ–π DLL –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
- **–¢–µ–ø–µ—Ä—å**: –ö–∞–∂–¥—ã–π COM-–æ–±—ä–µ–∫—Ç –∏–º–µ–µ—Ç —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ —ç–∫–∑–µ–º–ø–ª—è—Ä—ã native-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç, HMODULE –∏ –º–µ–Ω–µ–¥–∂–µ—Ä –ø–∞–º—è—Ç–∏

### üõ°Ô∏è –£–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–∏–ø–æ–≤ –∏ –ø–∞–º—è—Ç–∏
- **–†–∞–Ω—å—à–µ**: –ü—Ä–æ—Å—Ç—ã–µ –≥–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ `FromNativeToCOM`/`FromComToNative` –±–µ–∑ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ by-ref –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- **–¢–µ–ø–µ—Ä—å**: –ü–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –ø–æ —Å—Å—ã–ª–∫–µ (`VTYPE_BYREF`), –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç—å—é —á–µ—Ä–µ–∑ `MyMemoryManager`

### üìã –†–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–µ –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤
- **–†–∞–Ω—å—à–µ**: –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ 1–°
- **–¢–µ–ø–µ—Ä—å**: –ü–æ–ª–Ω–æ–µ –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ `IMsgBox`, `IPlatformInfo`, `IAttachedInfo`, `ILocale`, `IUserInterfaceLanguage`

### üìä –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
- **–†–∞–Ω—å—à–µ**: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è, –æ—à–∏–±–∫–∏ —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ `IErrorLog`
- **–¢–µ–ø–µ—Ä—å**: –ü–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ —Ñ–∞–π–ª —Å –≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –º–µ—Ç–∫–∞–º–∏, —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ DLL –∏ –≤—ã–∑–æ–≤–æ–≤ –º–µ—Ç–æ–¥–æ–≤

### üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è —á–∏—Å—Ç–æ—Ç–∞
- **–†–∞–Ω—å—à–µ**: –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏, –∂–µ—Å—Ç–∫–æ –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã (–º–µ—Ç–æ–¥ 999)
- **–¢–µ–ø–µ—Ä—å**: –û–±—ä–µ–∫—Ç–Ω–æ-–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –¥–∏–∑–∞–π–Ω —Å —á–µ—Ç–∫–æ–π –∏–Ω–∫–∞–ø—Å—É–ª—è—Ü–∏–µ–π, –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏ –∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–æ–≤

### üîß –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å –∏ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å
- **–†–∞–Ω—å—à–µ**: –†–∏—Å–∫–∏ —É—Ç–µ—á–µ–∫ –ø–∞–º—è—Ç–∏, –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Ç—Ä–æ–∫
- **–¢–µ–ø–µ—Ä—å**: –°—Ç—Ä–æ–≥–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç—å—é, –ø–æ–¥–¥–µ—Ä–∂–∫–∞ Windows XP, –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è —Ç–∏–ø–æ–≤

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
- `src/` ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–¥ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- `include/` ‚Äî –∑–∞–≥–æ–ª–æ–≤–∫–∏ 1–° (ComponentBase, types –∏ —Ç.–¥.)
- `test/` ‚Äî —Ç–µ—Å—Ç—ã –∏ –ø—Ä–∏–º–µ—Ä–Ω—ã–µ DLL
- `example/`, `template/` ‚Äî –ø—Ä–∏–º–µ—Ä—ã/—à–∞–±–ª–æ–Ω—ã (–Ω–µ —É—á–∞—Å—Ç–≤—É—é—Ç –≤ —Å–±–æ—Ä–∫–µ)

## –°–±–æ—Ä–∫–∞
–°–±–æ—Ä–∫–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ `build.cmd` (MSVC + CMake):

```
build.cmd
```

–î–ª—è —Å–±–æ—Ä–∫–∏ 32-–±–∏—Ç–Ω–æ–π –≤–µ—Ä—Å–∏–∏:
```
build_x86.cmd
```

–î–ª—è —Å–±–æ—Ä–∫–∏ 64-–±–∏—Ç–Ω–æ–π –≤–µ—Ä—Å–∏–∏:
```
build_x64.cmd
```

## –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è COM
–ó–∞–ø—É—Å–∫–∞—Ç—å –æ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞:

32-–±–∏—Ç–Ω–∞—è –≤–µ—Ä—Å–∏—è:
```
C:\Windows\SysWOW64\regsvr32.exe "C:\GIT\UniversalNativeWrapperNew\build-x86\Release\UniversalNativeWrapper.dll"
```

64-–±–∏—Ç–Ω–∞—è –≤–µ—Ä—Å–∏—è:
```
C:\Windows\System32\regsvr32.exe "C:\GIT\UniversalNativeWrapperNew\build-x64\Release\UniversalNativeWrapper.dll"
```

## –¢–µ—Å—Ç—ã (VBScript)
```
cscript //nologo test\RunTest64.vbs
cscript //nologo test\RunTest32.vbs
```

## –¢–µ—Å—Ç—ã (1C BSL)
–ü—Ä–∏–º–µ—Ä —Å—Ü–µ–Ω–∞—Ä–∏—è: `test/RunTestKKT.bsl`.

## –õ–æ–≥–∏
–õ–æ–≥ –ø–∏—à–µ—Ç—Å—è –≤ `temp/UniversalNativeWrapper.log`.

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

1. **–°–æ–±–µ—Ä–∏—Ç–µ DLL** –¥–ª—è –Ω—É–∂–Ω–æ–π —Ä–∞–∑—Ä—è–¥–Ω–æ—Å—Ç–∏ (x86/x64)
2. **–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ** —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–π –≤–µ—Ä—Å–∏–µ–π `regsvr32`
3. **–°–æ–∑–¥–∞–π—Ç–µ COM-–æ–±—ä–µ–∫—Ç** –≤ 1–° –∏–ª–∏ VBScript:
   ```vbs
   Set wrapper = CreateObject("Addin.UniversalNativeWrapper")
   result = wrapper.setDriverName("C:\path\to\dll", "ComponentName")
   ```
4. **–í—ã–∑—ã–≤–∞–π—Ç–µ –º–µ—Ç–æ–¥—ã** native-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —á–µ—Ä–µ–∑ wrapper

## –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å
- Windows 7+ (—Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π Windows XP –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏)
- 1C:–ü—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–µ 8.x
- Native AddIn API —Å–æ–≤–º–µ—Å—Ç–∏–º—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

## –õ–∏—Ü–µ–Ω–∑–∏—è
MIT + Commons Clause (–∑–∞–ø—Ä–µ—â–∞–µ—Ç –ø–µ—Ä–µ–ø—Ä–æ–¥–∞–∂—É –ü–û, —Ä–∞–∑—Ä–µ—à–∞–µ—Ç –∫–æ–º–º–µ—Ä—á–µ—Å–∫–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ)